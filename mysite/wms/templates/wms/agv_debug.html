{% extends 'wms/base.html' %}
{% load static i18n widget_tweaks %}

{% block css %}
<link href="{% static 'select2/css/select2.min.css' %}" rel="stylesheet" type="text/css">
<link href="{% static 'select2/css/select2-bootstrap4.min.css' %}" rel="stylesheet" type="text/css">
<link href="{% static 'wms/css/agv.css' %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block title %}{% trans 'AGV Debug' %}{% endblock %}

{% block body %}
<section class="content-header p-2">
    <div class="d-sm-flex justify-content-center">
        <p class="font-weight-bold my-0">{% trans 'AGV Debug' %}</p>
    </div>
</section>

<section class="content">
    <div class="row justify-content-center">
        <div class="col-md-4">
            <div class="card card-outline card-info shadow" id="agvproductionplan-table">
                <div class="card-header">
                    <h3 class="card-title font-weight-bold">{% trans 'Production Plan' %}</h3>
                </div>
                <div class="card-body table-responsive">
                    <script type="text/javascript">
                    var api_agvproductionplan = '{% url 'wms:agvproductionplan-list' %}'
                    url_agvproductionplan_form = []
                    {% for item in agvproductionplan %}
                        url_agvproductionplan_form[{{ item.id|escape }}] = "{% url 'wms:agvproductionplan_form' item.id %}"
                    {% endfor %}
                    function render_agvproductionplan(response) {
                        $("#agvproductionplan-table .table-responsive").empty()
                        if (Object.keys(response).length > 0) {
                            var data = "<table class='table table-sm table-hover'>" +
                                "<th>{% trans 'Product Name' %}</th>" +
                                "<th>{% trans 'Lot Name' %}</th>" +
                                "<th>{% trans 'Total Qty (Bags)' %}</th>" +
                                "<th>{% trans 'Remaining Qty (Bags)' %}</th>" +
                                "<th>{% trans '% Complete' %}</th>" +
                                "</tr>" +
                                "</thead>" +
                                "<tbody>"
                            $.each(response, function (key, value) {
                                data += "<tr>" +
                                "<td><a href='#' onclick=PopupCenter('" + url_agvproductionplan_form[value.id] + "','Popup','400','600')>" + value.product_name + "</a></td>" +
                                "<td>" + value.lot_name + "</td>" +
                                "<td>" + value.qty_total + "</td>" +
                                "<td>" + value.qty_remain + "</td>" +
                                "<td>" + value.percent_complete + "</td>" +
                                "</tr>"
                            })
                            data += "</tbody>" +
                                "</table>" +
                                "<div align='center'>" +
                                "<a class='btn btn-danger' href='{% url 'wms:agvproductionplan_clear' %}' onclick=return confirm('{% trans 'Are you sure?' %}')>{% trans 'Clear All' %}</a>" +
                                "</div>"
                            $("#agvproductionplan-table .table-responsive").append(data)
                        }
                    }
                    </script>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card card-outline card-warning shadow" id="robotqueue-table">
                <div class="card-header">
                    <h3 class="card-title font-weight-bold">{% trans 'Robot Queue' %}</h3>
                </div>
                <div class="card-body table-responsive">
                    <script type="text/javascript">
                    var api_robotqueue = '{% url 'wms:robotqueue-list' %}'
                    url_robotqueue_form = []
                    {% for item in robotqueue %}
                        url_robotqueue_form[{{ item.id|escape }}] = "{% url 'wms:robotqueue_form' item.id %}"
                    {% endfor %}
                    function render_robotqueue(response) {
                        $("#robotqueue-table .table-responsive").empty()
                        if (Object.keys(response).length > 0) {
                            var data = "<table class='table table-sm table-hover'>" +
                                "<th>{% trans 'Robot No.' %}</th>" +
                                "<th>{% trans 'Product Name' %}</th>" +
                                "<th>{% trans 'Qty (Bags)' %}</th>" +
                                "<th>{% trans 'Status' %}</th>" +
                                "</tr>" +
                                "</thead>" +
                                "<tbody>"
                            $.each(response, function (key, value) {
                                data += "<tr>" +
                                    "<td><a href='#' onclick=PopupCenter('" + url_robotqueue_form[value.id] + "','Popup','400','600')>" + value.robot_no + "</a></td>" +
                                    "<td>" + value.product_id + "</td>" +
                                    "<td>" + value.qty_act + "</td>" +
                                    "<td>" + value.updated + "</td>" +
                                    "</tr>"
                            })
                            data += "</tbody>" +
                                "</table>" +
                                "<div align='center'>" +
                                "<a class='btn btn-danger' href='{% url 'wms:robotqueue_clear' %}' onclick=return confirm('{% trans 'Are you sure?' %}')>{% trans 'Clear All' %}</a>" +
                                "</div>"
                            $("#robotqueue-table .table-responsive").append(data)
                        }
                    }
                    </script>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card card-outline card-success shadow" id="agvqueue-table">
                <div class="card-header">
                    <h3 class="card-title font-weight-bold">{% trans 'AGV Queue' %}</h3>
                </div>
                <div class="card-body table-responsive">
                    <script type="text/javascript">
                    var api_agvqueue = '{% url 'wms:agvqueue-list' %}'
                    url_agvqueue_form = []
                    {% for item in agvqueue %}
                        url_agvqueue_form[{{ item.id|escape }}] = "{% url 'wms:agvqueue_form' item.id %}"
                    {% endfor %}
                    function render_agvqueue(response) {
                        $("#agvqueue-table .table-responsive").empty()
                        if (Object.keys(response).length > 0) {
                            var data = "<table class='table table-sm table-hover'>" +
                                "<th>{% trans 'Product Name' %}</th>" +
                                "<th>{% trans 'Lot Name' %}</th>" +
                                "<th>{% trans 'Qty (Bags)' %}</th>" +
                                "<th>{% trans 'Robot No.' %}</th>" +
                                "<th>{% trans 'Pick Location' %}</th>" +
                                "<th>{% trans 'Place Location' %}</th>" +
                                "<th>{% trans 'Mode' %}</th>" +
                                "<th>{% trans 'AGV No.' %}</th>" +
                                "</tr>" +
                                "</thead>" +
                                "<tbody>"
                            $.each(response, function (key, value) {
                                data += "<tr>" +
                                    "<td><a href='#' onclick=PopupCenter('" + url_agvqueue_form[value.id] + "','Popup','400','600')>" + value.product_name + "</a></td>" +
                                    "<td>" + value.lot_name + "</td>" +
                                    "<td>" + value.qty_act + "</td>" +
                                    "<td>" + value.robot_no + "</td>" +
                                    "<td>" + value.pick_id + "</td>" +
                                    "<td>" + value.place_id + "</td>" +
                                    "<td>" + value.mode + "</td>" +
                                    "<td>" + value.agv_no + "</td>" +
                                    "</tr>"
                            })
                            data += "</tbody>" +
                                "</table>" +
                                "<div align='center'>" +
                                "<a class='btn btn-danger' href='{% url 'wms:agvqueue_clear' %}' onclick=return confirm('{% trans 'Are you sure?' %}')>{% trans 'Clear All' %}</a>" +
                                "</div>"
                            $("#agvqueue-table .table-responsive").append(data)
                        }
                    }
                    </script>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col">
            <div class="table-responsive" id="agvtransfer-table">
                <table class="table table-sm table-hover">
                    <thead>
                        <tr>
                            <th>{% trans 'AGV Run' %}</th>
                            <th>{% trans 'AGV Status' %}</th>
                            <th>{% trans 'Step' %}</th>
                            <th>{% trans 'X NAV' %}</th>
                            <th>{% trans 'Y NAV' %}</th>
                            <th>{% trans 'Beta NAV' %}</th>
                            <th>{% trans 'Pattern' %}</th>
                            <th>X1</th>
                            <th>Y1</th>
                            <th>X2</th>
                            <th>Y2</th>
                            <th>X3</th>
                            <th>Y3</th>
                            <th>X4</th>
                            <th>Y4</th>
                            <th>X5</th>
                            <th>Y5</th>
                        </tr>
                    </thead>
                    <tbody>
                        <script type="text/javascript">
                        var api_agvtransfer = '{% url 'wms:agvtransfer-list' %}'
                        url_agvtransfer_form = []
                        {% for item in agvtransfer %}
                            url_agvtransfer_form[{{ item.id|escape }}] = "{% url 'wms:agvtransfer_form' item.id %}"
                        {% endfor %}
                        function render_agvtransfer(response) {
                            $("#agvtransfer-table tbody").empty()
                            $.each(response, function (key, value) {
                                var data = "<tr>" +
                                    "<td>" + value.run + "</td>" +
                                    "<td><a href='#' onclick=PopupCenter('" + url_agvtransfer_form[value.id] + "','Popup','400','600')>" + value.status + "</a></td>" +
                                    "<td>" + value.step + "</td>" +
                                    "<td>" + value.x_nav + "</td>" +
                                    "<td>" + value.y_nav + "</td>" +
                                    "<td>" + value.beta_nav + "</td>" +
                                    "<td>" + value.pattern + "</td>" +
                                    "<td>" + value.x1 + "</td>" +
                                    "<td>" + value.y1 + "</td>" +
                                    "<td>" + value.x2 + "</td>" +
                                    "<td>" + value.y2 + "</td>" +
                                    "<td>" + value.x3 + "</td>" +
                                    "<td>" + value.y3 + "</td>" +
                                    "<td>" + value.x4 + "</td>" +
                                    "<td>" + value.y4 + "</td>" +
                                    "<td>" + value.x5 + "</td>" +
                                    "<td>" + value.y5 + "</td>" +
                                    "</tr>"
                                $("#agvtransfer-table tbody").append(data)
                            })
                        }
                        </script>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-md-4">
            <div class="card card-secondary">
                <div class="card-header">
                    <h3 class="card-title">{% trans 'Robot Order' %}</h3>
                    <div class="card-tools">
                        <!-- Collapse Button -->
                        <button class="btn btn-tool m-0 p-0" data-card-widget="collapse" type="button"><i class="fas fa-minus"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <form method="post" name="robot-form" novalidate>
                        {% csrf_token %}
                        {% for hidden in robot_form.hidden_fields %}{{ hidden }}{% endfor %}
                        {% for field in robot_form.visible_fields %}
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label" for="{{ field.id_for_label }}">{{ field.label }} :</label>
                            <div class="col-sm-8">
                                {% if robot_form.is_bound %}
                                {% if field.errors %}
                                {% if not field|widget_type == 'select' %}
                                {% render_field field class="form-control is-invalid" %}
                                {% else %}
                                {% render_field field class="form-control is-invalid select2" %}
                                {% endif %}
                                {% for error in field.errors %}
                                <div class="invalid-feedback">
                                    {{ error }}
                                </div>
                                {% endfor %}
                                {% else %}
                                {% if not field|widget_type == 'select' %}
                                {% render_field field class="form-control is-valid" %}
                                {% else %}
                                {% render_field field class="form-control is-valid select2" %}
                                {% endif %}
                                {% endif %}
                                {% else %}
                                {% if not field|widget_type == 'select' %}
                                {% render_field field class="form-control" %}
                                {% else %}
                                {% render_field field class="form-control select2" %}
                                {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                        <div align="center">
                            <button class="btn btn-success" name="robot" type="submit">{% trans 'Submit' %}</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card card-secondary">
                <div class="card-header">
                    <h3 class="card-title">{% trans 'Manual Move AGV' %}</h3>
                    <div class="card-tools">
                        <!-- Collapse Button -->
                        <button class="btn btn-tool m-0 p-0" data-card-widget="collapse" type="button"><i class="fas fa-minus"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <form method="post" name="manualtransfer-form" novalidate>
                        <fieldset %} %}disabled{% endif if queue {%>
                            {% csrf_token %}
                            {% for hidden in manualtransfer_form.hidden_fields %}{{ hidden }}{% endfor %}
                            {% for field in manualtransfer_form.visible_fields %}
                            <div class="form-group row">
                                <label class="col-sm-4 col-form-label" for="{{ field.id_for_label }}">{{ field.label }} :</label>
                                <div class="col-sm-8">
                                    {% if manualtransfer_form.is_bound %}
                                    {% if field.errors %}
                                    {% if not field|widget_type == 'select' %}
                                    {% render_field field class="form-control is-invalid" %}
                                    {% else %}
                                    {% render_field field class="form-control is-invalid select2" %}
                                    {% endif %}
                                    {% for error in field.errors %}
                                    <div class="invalid-feedback">
                                        {{ error }}
                                    </div>
                                    {% endfor %}
                                    {% else %}
                                    {% if not field|widget_type == 'select' %}
                                    {% render_field field class="form-control is-valid" %}
                                    {% else %}
                                    {% render_field field class="form-control is-valid select2" %}
                                    {% endif %}
                                    {% endif %}
                                    {% else %}
                                    {% if not field|widget_type == 'select' %}
                                    {% render_field field class="form-control" %}
                                    {% else %}
                                    {% render_field field class="form-control select2" %}
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                            <div align="center">
                                <button class="btn btn-success" name="manualtransfer" onclick="return confirm('{% trans 'Manual transfer. Are you sure?' %}')" type="submit">{% trans 'Submit' %}</button>
                                <br>
                                <a class="btn btn-secondary mt-1" id="agv_to_home" onclick="return confirm('{% trans 'Back to home. Are you sure?' %}')" role="button">{% trans 'Go Home' %}</a>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modal" role="dialog" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content"></div>
        </div>
    </div>
</section>
{% endblock %}

{% block javascript %}

<script type="text/javascript">
    url_agv_to_home = []
    {% for item in agvtransfer %}
        url_agv_to_home[{{ item.id }}] = "{% url 'wms:agv_to_home' item.id %}"
    {% endfor %}
</script>

<script type="text/javascript" src="{% static 'select2/js/select2.min.js' %}"></script>
<script type="text/javascript" src="{% static 'select2/js/th.js' %}"></script>
<script type="text/javascript" src="{% static 'wms/js/agv_debug.js' %}"></script>
<script type="text/javascript" src="{% static 'wms/js/PopupCenter.js' %}"></script>

{% endblock %}